/*
 * scrollNav
 * http://scrollnav.com
 *
 * Copyright (c) 2013 James Wilson
 * Licensed under the MIT license.
 */
(function(e){e.fn.scrollNav=function(t){var n=e.extend({sections:"h2",subSections:false,showHeadline:true,headlineText:"Scroll To",showTopLink:true,topLinkText:"Top",fixedMargin:40,scrollOffset:40,animated:true,speed:500,insertTarget:this.selector,insertLocation:"insertBefore",arrowKeys:false},t);var r;var i;var s;var o;var u=[];var a=[];var f=[];var l=this;var c=e(n.insertTarget);var h=e("<span />",{"class":"scroll-nav__heading",text:n.headlineText});var p=e("<div />",{"class":"scroll-nav__wrapper"});var d=e("<nav />",{"class":"scroll-nav",role:"navigation"});var v=function(){return window.location.hash};var m=function(){e("body").addClass("sn-loading")};var g=function(t){if(t){e("body").removeClass("sn-loading").addClass("sn-active")}else{e("body").removeClass("sn-loading").addClass("sn-failed")}};var y=function(){if(n.showTopLink){var t=l.children().first();if(!t.is(n.sections)){u.push(t.nextUntil(n.sections).andSelf())}}l.find(n.sections).each(function(){u.push(e(this).nextUntil(n.sections).andSelf())})};var b=function(){e(u).each(function(t){var r=[];var i=e(this);var s="scrollNav-"+(t+1);var o=i.offset().top;var u=function(){return t===0};var f=function(){return!i.eq(0).is(n.sections)};var l=n.showTopLink&&u()&&f()?n.topLinkText:i.filter(n.sections).text();if(n.subSections){var c=i.filter(n.subSections);if(c.length>0){c.each(function(t){var n=s+"-"+(t+1);var o=e(this).offset().top;var u=e(this).text();var a=i.filter(e(this).nextUntil(c).andSelf());a.wrapAll('<div id="'+n+'" class="scroll-nav__sub-section" />');r.push({id:n,offset:o,text:u})});i=e(this).nextUntil(n.sections).andSelf()}}i.wrapAll('<section id="'+s+'" />');a.push({id:s,offset:o,text:l,subSections:r})})};var w=function(){var t=e("<ol />",{"class":"scroll-nav__list"});e.each(a,function(n){var r=n===0?e("<li />",{"class":"scroll-nav__item active"}):e("<li />",{"class":"scroll-nav__item"});var i=e("<a />",{href:"#"+this.id,"class":"scroll-nav__link",text:this.text});var s;if(this.subSections.length>0){r.addClass("is-parent-item");s=e("<ol />",{"class":"scroll-nav__sub-list"});e.each(this.subSections,function(){var t=e("<li />",{"class":"scroll-nav__sub-item"});var n=e("<a />",{href:"#"+this.id,"class":"scroll-nav__sub-link",text:this.text});s.append(t.append(n))})}t.append(r.append(i).append(s))});if(n.showHeadline){d.append(p.append(h).append(t))}else{d.append(p.append(t))}};var E=function(){d[n.insertLocation](c)};var S=function(){r=e(window).height();i=d.offset().top;e.each(a,function(){var t=e("#"+this.id);var n=t.height();this.topOffset=t.offset().top;this.bottomOffset=this.topOffset+n})};var x=function(){var t=e(window).scrollTop();s=t+n.scrollOffset;o=t+r-n.scrollOffset;f.length=0;if(t>i-n.fixedMargin){d.addClass("fixed")}else{d.removeClass("fixed")}e.each(a,function(){if(this.topOffset>s&&this.topOffset<o||this.bottomOffset>s&&this.bottomOffset<o||this.topOffset<s&&this.bottomOffset>o){f.push(this)}});d.find(".scroll-nav__item").removeClass("active").removeClass("in-view");e.each(f,function(e){if(e===0){d.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("active").addClass("in-view")}else{d.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("in-view")}e++})};var T=function(){e(window).resize(function(){S();x()});e(window).scroll(function(){x()})};var N=function(t){if(e(t).length>0){var r=e(t).offset().top;var i=n.animated?n.speed:0;e("html:not(:animated),body:not(:animated)").animate({scrollTop:r-n.scrollOffset},i)}};var C=function(){e(".scroll-nav").find("a").click(function(t){t.preventDefault();N(e(this).attr("href"))})};var k=function(){if(n.arrowKeys){e(document).keydown(function(e){if(e.keyCode===40||e.keyCode===38){var t=function(e){var t=0;var n=a.length;for(t;t<n;t++){if(a[t].id===f[0].id){var r=e===40?t+1:t-1;var i=a[r]===undefined?undefined:a[r].id;return i}}};var n=t(e.keyCode);if(n!==undefined){e.preventDefault();N("#"+n)}}})}};var L=function(t){if(t&&e(t).length>0){var n=e(t).offset().top;if(n<s||n>o){N(t)}}};if(l.length>0){m();y();if(l.find(n.sections).length>0){b();w();if(c.length>0){E();S();x();T();C();k();g(true);L(v())}else{console.log('Build failed, scrollNav could not find "'+n.insertTarget+'"');g(false)}}else{console.log('Build failed, scrollNav could not find any "'+n.sections+'s" inside of "'+l.selector+'"');g(false)}}else{console.log('Build failed, scrollNav could not find "'+l.selector+'"');g(false)}return this}})(jQuery)